# 页面有效性检测功能说明

## 🎯 功能概述

新增的页面有效性检测功能可以自动识别已被删除或违规的文章，避免在这些无效页面上浪费时间重试。

## 🔍 检测机制

### 检测的关键词
程序会检测以下关键词来判断页面是否有效：

- `此内容发送失败无法查看`
- `此内容因涉嫌违反相关法律法规和政策发送失败`
- `内容已删除`
- `文章不存在`
- `该内容已被删除`
- `内容违规`
- `无法查看`
- `发送失败`
- `违规内容`
- `内容不存在`

### 检测流程
1. 页面加载完成后，获取页面完整内容
2. 检查是否包含上述任何关键词
3. 如果检测到关键词，立即标记为无效页面并跳过
4. 不再进行重试，节省时间和资源

## 📊 输出示例

### 控制台输出
```
🔍 抓取第 3 篇文章: https://mp.weixin.qq.com/s/example
    尝试第 1 次访问...
    ⚠️  检测到无效页面，文章可能已被删除或违规

🎉 抓取完成！
📊 统计信息:
   时间范围: 过去三个月
   总计: 5 篇文章
   成功: 3 篇
   失败: 2 篇
   📄 其中已删除/违规: 1 篇
   成功率: 60.0%

❌ 失败分析:
   文章已被删除或违规，无法查看: 1 篇
   重试 5 次后仍然失败: 网络超时: 1 篇

💡 说明:
   - 部分文章已被删除或违规，这是正常现象
   - 程序已自动识别并跳过这些无效页面，节省了抓取时间
```

### JSON 输出
在 `crawl_info.json` 中会包含删除文章统计：

```json
{
  "crawl_time": "2025-01-15T14:30:22",
  "time_range": "过去三个月",
  "total_articles": 5,
  "success_count": 3,
  "fail_count": 2,
  "deleted_count": 1,
  "success_rate": "60.0%",
  "error_analysis": {
    "文章已被删除或违规，无法查看": 1,
    "重试 5 次后仍然失败: 网络超时": 1
  }
}
```

## ⚡ 性能提升

### 时间节省
- **之前**: 无效页面会重试 5 次，每次等待 3-15 秒，总计浪费 45-75 秒
- **现在**: 检测到无效页面立即跳过，节省 45-75 秒

### 成功率提升
- 避免在无效页面上浪费时间
- 将更多时间用于抓取有效文章
- 整体成功率统计更准确

## 🛠️ 自定义检测

如果需要添加更多检测关键词，可以修改 `fetch_article_content` 函数中的 `invalid_keywords` 列表：

```python
invalid_keywords = [
    "此内容发送失败无法查看",
    "此内容因涉嫌违反相关法律法规和政策发送失败",
    "内容已删除",
    "文章不存在",
    "该内容已被删除",
    "内容违规",
    "无法查看",
    "发送失败",
    "违规内容",
    "内容不存在",
    # 添加你的自定义关键词
    "你的自定义关键词"
]
```

## 🧪 测试功能

使用 `test_page_detection.py` 脚本可以测试页面检测功能：

1. 在脚本中添加要测试的URL
2. 运行脚本查看检测结果
3. 验证检测准确性

```bash
python test_page_detection.py
```

## 📝 注意事项

1. **关键词匹配**: 使用简单的字符串匹配，区分大小写
2. **误判风险**: 如果正常文章内容恰好包含这些关键词，可能会被误判
3. **更新维护**: 如果微信更新了删除页面的文案，需要相应更新关键词列表
4. **网络问题**: 网络超时等非内容问题仍会进行重试

## 🎉 使用效果

通过这个功能，你的抓取效率将显著提升：

- **减少无效重试**: 避免在已删除文章上浪费时间
- **提高成功率**: 更准确的成功率统计
- **节省时间**: 每篇无效文章节省 45-75 秒
- **更好的体验**: 清晰的失败原因分析 