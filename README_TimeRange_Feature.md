# 微信公众号文章时间范围筛选功能

## 🎯 功能概述

新增的时间范围筛选功能允许你根据文章发布时间来选择性抓取文章，大大提升抓取效率和用户体验。

## 📅 支持的时间范围选项

### 预设时间范围（快速选择）
1. **过去一年** (365天) - 适合年度回顾
2. **过去半年** (180天) - 适合半年总结
3. **过去三个月** (90天) - 适合季度分析
4. **过去一个月** (30天) - 适合月度报告
5. **过去一周** (7天) - 适合周报
6. **今年** (1月1日至今) - 适合年度统计
7. **去年** (全年) - 适合历史对比

### 自定义时间范围
- 支持任意自定义开始和结束日期
- 日期格式：`YYYY-MM-DD`（如：2024-01-01）

### 其他选项
- **抓取所有文章** - 不限制时间范围
- **退出程序** - 取消操作

## 🚀 使用方法

### 1. 运行脚本
```bash
python wechat_mp_batch_scraper_from_json.py
```

### 2. 选择时间范围
程序会显示菜单，你可以选择：

```
📅 请选择抓取文章的时间范围：
==================================================
1. 过去一年 (365天)
2. 过去半年 (180天)
3. 过去三个月 (90天)
4. 过去一个月 (30天)
5. 过去一周 (7天)
6. 今年 (1月1日至今)
7. 去年 (全年)
8. 自定义时间范围
9. 抓取所有文章
0. 退出程序
==================================================
请选择 (0-9): 
```

### 3. 确认抓取
选择时间范围后，程序会显示：
- 筛选结果的文章数量
- 时间范围详情
- 确认是否开始抓取

## 💡 使用场景示例

### 场景1：月度报告
```
选择: 4 (过去一个月)
结果: 筛选出最近30天的文章
用途: 生成月度内容分析报告
```

### 场景2：年度总结
```
选择: 6 (今年)
结果: 筛选出今年1月1日至今的所有文章
用途: 年度内容回顾和统计
```

### 场景3：特定时期分析
```
选择: 8 (自定义时间范围)
输入: 2024-06-01 至 2024-08-31
结果: 筛选出夏季三个月的文章
用途: 季节性内容分析
```

### 场景4：快速测试
```
选择: 5 (过去一周)
结果: 筛选出最近7天的文章
用途: 功能测试，快速验证抓取效果
```

## 📊 输出文件夹结构

每次抓取完成后，会创建一个独立的文件夹：

```
articles_batch_20250115_143022/
├── articles_detailed.json    # 文章详细数据
└── crawl_info.json          # 抓取信息记录
```

### 文件夹命名规则
- 格式：`articles_batch_YYYYMMDD_HHMMSS`
- 示例：`articles_batch_20250115_143022`

### 文件说明
- **articles_detailed.json**: 包含所有抓取的文章详细内容
- **crawl_info.json**: 记录抓取时间、范围、统计信息等元数据

## 🎨 用户体验优化

### 1. 智能日期解析
- 支持多种日期格式：`YYYY-MM-DD`、`YYYY年MM月DD日`、`YYYY/MM/DD`、`YYYY.MM.DD`
- 自动识别和转换日期格式

### 2. 详细统计信息
抓取完成后显示：
- 时间范围名称
- 筛选条件
- 总文章数
- 成功/失败数量
- 成功率百分比

### 3. 交互式确认
- 显示筛选结果数量
- 确认是否继续抓取
- 支持随时取消操作

### 4. 错误处理
- 日期格式错误提示
- 无效选择重新输入
- 空时间范围检查

## 🔧 技术特性

### 1. 时间筛选算法
```python
def filter_articles_by_date(articles, start_date=None, end_date=None):
    """根据时间范围筛选文章"""
    filtered_articles = []
    
    for article in articles:
        article_date = parse_date(article.get('date', ''))
        
        if not article_date:
            continue
        
        # 检查是否在时间范围内
        if start_date and article_date < start_date:
            continue
        if end_date and article_date > end_date:
            continue
        
        filtered_articles.append(article)
    
    return filtered_articles
```

### 2. 预设时间计算
```python
def get_preset_date_range(option):
    """获取预设的时间范围"""
    today = datetime.now()
    
    if option == "1":  # 过去一年
        start_date = today - timedelta(days=365)
        return start_date, today, "过去一年"
    # ... 其他选项
```

## 📈 性能优化

### 1. 减少抓取数量
- 只抓取指定时间范围内的文章
- 大幅减少抓取时间和网络请求

### 2. 智能重试机制
- 失败文章自动重试3次
- 每次重试间隔5秒
- 避免因临时网络问题导致的失败

### 3. 防反爬虫策略
- 每次抓取间隔3秒
- 模拟真实用户行为
- 降低被封禁风险

## 🎯 最佳实践建议

### 1. 首次使用
- 建议选择"过去一周"进行测试
- 验证抓取效果和网络稳定性
- 确认输出格式符合预期

### 2. 大量数据抓取
- 建议分批抓取，避免一次性抓取过多
- 可以先抓取"过去一个月"测试
- 确认无误后再抓取更长时间范围

### 3. 定期抓取
- 可以设置定时任务，每周抓取"过去一周"的文章
- 保持数据的时效性和完整性

### 4. 数据分析
- 结合时间范围进行内容趋势分析
- 对比不同时期的内容特点
- 生成有价值的内容洞察报告

## 🔍 故障排除

### 问题1：日期解析失败
**现象**: 显示"日期格式错误"
**解决**: 确保日期格式为 `YYYY-MM-DD`，如 `2024-01-01`

### 问题2：筛选结果为空
**现象**: 显示"该时间范围内没有找到文章"
**解决**: 
- 检查 ArticleList.json 中的日期格式
- 确认时间范围设置是否正确
- 尝试扩大时间范围

### 问题3：抓取失败率高
**现象**: 成功率低于80%
**解决**:
- 检查网络连接稳定性
- 尝试减少抓取数量
- 增加抓取间隔时间

## 📂 文件夹管理工具

### 使用方法
```bash
python folder_manager.py
```

### 功能特性
1. **查看所有抓取结果文件夹** - 列出所有批次的结果
2. **查看文件夹详细信息** - 显示抓取时间、范围、统计等
3. **删除指定文件夹** - 安全删除不需要的结果
4. **清理所有抓取结果** - 批量清理所有结果文件夹
5. **打开指定文件夹** - 在文件管理器中打开文件夹

### 管理界面示例
```
📂 微信公众号文章抓取结果管理器
==================================================
请选择操作:
1. 查看所有抓取结果文件夹
2. 查看文件夹详细信息
3. 删除指定文件夹
4. 清理所有抓取结果
5. 打开指定文件夹
0. 退出
```

## 📝 更新日志

### v2.1.0 (当前版本)
- ✅ 新增独立文件夹输出功能
- ✅ 新增抓取信息记录文件
- ✅ 新增文件夹管理工具
- ✅ 支持文件夹批量管理
- ✅ 优化文件组织结构

### v2.0.0
- ✅ 新增时间范围筛选功能
- ✅ 支持7种预设时间范围
- ✅ 支持自定义时间范围
- ✅ 优化用户交互体验
- ✅ 增加详细统计信息
- ✅ 改进错误处理机制 