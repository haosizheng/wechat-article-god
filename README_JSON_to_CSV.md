# JSON 转 CSV/Excel 工具使用指南

## 🎯 功能概述

这个工具可以将抓取到的微信公众号文章 JSON 数据转换为 CSV 和 Excel 格式，方便导入到 Notion、Excel 或其他数据分析工具中。

## 📁 文件说明

### 基础版本
- **`json_to_csv.py`** - 基础转换工具，处理当前目录的 JSON 文件

### 高级版本
- **`json_to_csv_advanced.py`** - 高级转换工具，支持处理多个抓取结果文件夹

## 🚀 使用方法

### 方法一：基础版本（简单使用）

#### 1. 直接运行
```bash
cd wechatarticlesgod
python json_to_csv.py
```

**输出文件**：
- `articles.csv` - CSV 格式文件
- `articles.xlsx` - Excel 格式文件（需要安装 pandas 和 openpyxl）

#### 2. 安装依赖（可选）
如果需要生成 Excel 文件，请安装：
```bash
pip install pandas openpyxl
```

### 方法二：高级版本（推荐使用）

#### 1. 运行高级工具
```bash
cd wechatarticlesgod
python json_to_csv_advanced.py
```

#### 2. 选择操作
```
==================================================
📊 JSON 格式转换工具
==================================================
1. 转换当前目录的 articles_detailed.json
2. 转换所有抓取结果文件夹
3. 转换指定文件夹
4. 查看可用的文章文件
0. 退出
==================================================
请选择 (0-4):
```

## 📊 输出格式

### CSV 文件字段
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 标题 | 文章标题 | "如何提高工作效率" |
| 作者 | 公众号名称 | "职场进阶指南" |
| 发布时间 | 发布时间 | "2024-01-15" |
| 阅读量 | 阅读数 | "1234" |
| 点赞量 | 点赞数 | "56" |
| 链接 | 文章链接 | "https://mp.weixin.qq.com/s/..." |
| 内容 | 文章内容（CSV中截取前1000字符） | "文章正文内容..." |
| 错误信息 | 抓取错误信息 | "文章已被删除或违规，无法查看" |
| 状态 | 文章状态 | "deleted" |

### Excel 文件字段
与 CSV 相同，但内容字段不会被截取。

## 🔄 使用场景

### 场景一：导入到 Notion
1. 运行转换工具生成 CSV 文件
2. 在 Notion 中创建数据库
3. 使用 "Import" 功能导入 CSV 文件
4. 设置字段映射关系

### 场景二：Excel 分析
1. 运行转换工具生成 Excel 文件
2. 在 Excel 中打开文件
3. 进行数据分析和可视化

### 场景三：批量处理多个抓取结果
1. 运行高级版本工具
2. 选择 "转换所有抓取结果文件夹"
3. 一次性处理所有历史抓取数据

## 📋 操作示例

### 示例一：查看可用的抓取结果
```
请选择 (0-4): 4

📁 找到 3 个抓取结果文件夹:
   📁 articles_batch_20250115_143022
      📊 总计: 5 篇
      ✅ 成功: 4 篇
      ❌ 失败: 1 篇
      📄 删除: 1 篇
      📅 时间范围: 过去三个月
      🕐 抓取时间: 2025-01-15T14:30:22

   📁 articles_batch_20250114_093045
      📊 总计: 10 篇
      ✅ 成功: 8 篇
      ❌ 失败: 2 篇
      📄 删除: 0 篇
      📅 时间范围: 过去一个月
      🕐 抓取时间: 2025-01-14T09:30:45
```

### 示例二：转换指定文件夹
```
请选择 (0-4): 3

📁 可用的抓取结果文件夹:
   1. articles_batch_20250115_143022
   2. articles_batch_20250114_093045

请选择文件夹编号: 1

🔄 转换文件夹: articles_batch_20250115_143022
✅ 成功读取 5 篇文章
✅ 成功转换为 CSV 文件: articles_batch_20250115_143022/articles.csv
✅ 成功转换为 Excel 文件: articles_batch_20250115_143022/articles.xlsx
```

## 🛠️ 自定义配置

### 修改字段映射
如果需要修改输出字段，可以编辑脚本中的字段定义：

```python
row = {
    '标题': article.get('title', ''),
    '作者': article.get('author', ''),
    '发布时间': article.get('publish_time', ''),
    '阅读量': article.get('read_count', ''),
    '点赞量': article.get('like_count', ''),
    '链接': article.get('url', ''),
    '内容': article.get('content', ''),
    '错误信息': article.get('error', ''),
    '状态': article.get('status', '')
    # 添加自定义字段
    '自定义字段': article.get('custom_field', '')
}
```

### 修改内容截取长度
在 CSV 转换中，内容会被截取到 1000 字符：

```python
'内容': article.get('content', '')[:1000] + '...' if len(article.get('content', '')) > 1000 else article.get('content', '')
```

可以修改 `1000` 为其他数值。

## 📝 注意事项

### 1. 文件编码
- CSV 文件使用 `utf-8-sig` 编码，确保中文正确显示
- JSON 文件使用 `utf-8` 编码读取

### 2. 依赖要求
- **基础功能**：只需要 Python 标准库
- **Excel 功能**：需要安装 `pandas` 和 `openpyxl`

### 3. 文件路径
- 确保在正确的目录下运行脚本
- 脚本会自动查找 `articles_batch_*` 文件夹

### 4. 数据完整性
- 失败的文章会保留错误信息
- 删除的文章会标记状态为 `deleted`

## 🔧 故障排除

### 问题一：找不到 JSON 文件
**解决方案**：
1. 确认是否在正确的目录下运行
2. 检查是否有 `articles_detailed.json` 文件
3. 使用高级版本查看可用的文件

### 问题二：Excel 转换失败
**解决方案**：
```bash
pip install pandas openpyxl
```

### 问题三：中文显示乱码
**解决方案**：
1. 确保使用 `utf-8-sig` 编码的 CSV 文件
2. 在 Excel 中导入时选择正确的编码

### 问题四：内容被截取
**解决方案**：
- CSV 文件中的内容会被截取到 1000 字符
- 使用 Excel 文件可以获得完整内容

## 🎉 使用建议

1. **推荐使用高级版本**：功能更全面，支持批量处理
2. **定期转换**：每次抓取完成后及时转换，便于数据分析
3. **备份原始数据**：保留 JSON 文件作为原始数据备份
4. **结合 Notion 导入**：使用 CSV 文件可以方便地导入到 Notion 数据库 